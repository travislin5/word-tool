<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        .wrap {
            padding: 20px 20px 0 20px;
        }

        .file {
            width: 30%;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.7.1.js"
        integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
</head>

<body>
    <div class="wrap">
        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon1">指定的key</span>
            <input name="key1" type="text" class="form-control" aria-label="Username" aria-describedby="basic-addon1">

            <span class="input-group-text" id="basic-addon1">替換的文字</span>
            <input name="val1" type="text" class="form-control" aria-label="Username" aria-describedby="basic-addon1">
        </div>
        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon1">指定的key</span>
            <input name="key2" type="text" class="form-control" aria-label="Username" aria-describedby="basic-addon1">

            <span class="input-group-text" id="basic-addon1">替換的文字</span>
            <input name="val2" type="text" class="form-control" aria-label="Username" aria-describedby="basic-addon1">
        </div>
        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon1">指定的key</span>
            <input name="key3" type="text" class="form-control" aria-label="Username" aria-describedby="basic-addon1">

            <span class="input-group-text" id="basic-addon1">替換的文字</span>
            <input name="val3" type="text" class="form-control" aria-label="Username" aria-describedby="basic-addon1">
        </div>
        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon1">指定的key</span>
            <input name="key4" type="text" class="form-control" aria-label="Username" aria-describedby="basic-addon1">

            <span class="input-group-text" id="basic-addon1">替換的文字</span>
            <input name="val4" type="text" class="form-control" aria-label="Username" aria-describedby="basic-addon1">
        </div>
        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon1">指定的key</span>
            <input name="key5" type="text" class="form-control" aria-label="Username" aria-describedby="basic-addon1">

            <span class="input-group-text" id="basic-addon1">替換的文字</span>
            <input name="val5" type="text" class="form-control" aria-label="Username" aria-describedby="basic-addon1">
        </div>
        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon1">指定的key</span>
            <input name="key6" type="text" class="form-control" aria-label="Username" aria-describedby="basic-addon1">

            <span class="input-group-text" id="basic-addon1">替換的文字</span>
            <input name="val6" type="text" class="form-control" aria-label="Username" aria-describedby="basic-addon1">
        </div>
        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon1">指定的key</span>
            <input name="key7" type="text" class="form-control" aria-label="Username" aria-describedby="basic-addon1">

            <span class="input-group-text" id="basic-addon1">替換的文字</span>
            <input name="val7" type="text" class="form-control" aria-label="Username" aria-describedby="basic-addon1">
        </div>

        <div class="file input-group mb-3">
            <input name="file" type="file" class="form-control" id="inputGroupFile02">
            <label class="input-group-text" for="inputGroupFile02">Upload</label>
        </div>
        <button id="submit" type="button" class="btn btn-secondary">調整文字</button>

    </div>


    <script>
        $(document).ready(function () {
            // 當表單提交時觸發
            $('#submit').click(function () {

                // 選取所有 input 元素
                const inputs = $('input[type="text"], input[type="file"]');
                var formData = new FormData();

                inputs.each(function () {
                    const input = $(this);
                    const value = input.val();
                    formData.append(`${input.attr('name')}`, `${value}`);
                    if (`${input.attr('name')}` == "file") {
                        formData.append(`${input.attr('name')}`, input[0]);
                    }

                });

                $.ajax({
                    url: 'your-server-endpoint', // 替換為你的伺服器端點
                    type: 'POST',
                    data: formData,
                    processData: false, // 告訴 jQuery 不要處理數據
                    contentType: false, // 告訴 jQuery 不要設置內容類型
                    xhrFields: {
                        responseType: 'blob' // 設置響應類型為 blob
                    },
                    success: function (response) {
                        var filename = "";
                        var disposition = xhr.getResponseHeader('Content-Disposition');
                        if (disposition && disposition.indexOf('attachment') !== -1) {
                            var filenameRegex = /filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/;
                            var matches = filenameRegex.exec(disposition);
                            if (matches != null && matches[1]) {
                                filename = matches[1].replace(/['"]/g, '');
                            }
                        }

                        // 創建一個 Blob 對象來處理返回的數據
                        var blob = new Blob([response], { type: xhr.getResponseHeader('Content-Type') });
                        var url = window.URL.createObjectURL(blob);

                        // 創建一個隱藏的 a 元素並點擊它來觸發下載
                        var a = document.createElement('a');
                        a.style.display = 'none';
                        a.href = url;
                        a.download = filename || 'downloadedFile';
                        document.body.appendChild(a);
                        a.click();

                        // 移除 a 元素和釋放 URL 對象
                        window.URL.revokeObjectURL(url);
                        a.remove();

                        console.log('File downloaded successfully');
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        // 失敗時的處理代碼
                        console.error('File upload failed:', textStatus, errorThrown);
                    }
                });

            });
        });

    </script>


</body>

</html>